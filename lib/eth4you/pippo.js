function namehash(a){a=ens.normalise(a);var b=Buffer.alloc(32);if(a&&""!=a)for(var c=a.split("."),d=c.length-1;d>=0;d--)b=ethUtil.sha3(Buffer.concat([b,ethUtil.sha3(c[d])]));return"0x"+b.toString("hex")}function subnodehash(a){return a=ens.normalise(a),"0x"+ethUtil.sha3(a).toString("hex")}var uts46=require("./uts46"),registryInterface=require("./ensConfigs/registryABI.json"),resolverInterface=require("./ensConfigs/resolverABI.json"),ens=function(){var a=this;this.registryABI={};for(var b in registryInterface)this.registryABI[registryInterface[b].name]=registryInterface[b];this.resolverABI={};for(var b in resolverInterface)this.resolverABI[resolverInterface[b].name]=resolverInterface[b];switch(ajaxReq.type){case nodes.nodeTypes.ETH:a.setCurrentRegistry(ens.registry.ETH);break;case nodes.nodeTypes.Rinkeby:a.setCurrentRegistry(ens.registry.Rinkeby);break;case nodes.nodeTypes.Ropsten:a.setCurrentRegistry(ens.registry.ROPSTEN);break;default:a.setCurrentRegistry(ens.registry.NULL)}};ens.registry={ETH:require("./ensConfigs/ETHConfig.json"),Rinkeby:require("./ensConfigs/RinkebyConfig.json"),ROPSTEN:require("./ensConfigs/ROPConfig.json"),NULL:{}},ens.normalise=function(a){try{return uts46.toUnicode(a,{useStd3ASCII:!0,transitional:!1})}catch(b){throw b}},ens.prototype.setCurrentRegistry=function(a){this.curRegistry=a},ens.prototype.getRegistryAddress=function(){return this.curRegistry.registry},ens.getNameHash=function(a){return namehash(a)},ens.prototype.getOwnerResolverAddress=function(a,b,c,d){var e=this;ajaxReq.getEthCall({to:b,data:e.getDataString(a,[namehash(c)])},function(b){if(b.error)d(b);else{var c=a.outputs.map(function(a){return a.type});b.data=ethUtil.solidityCoder.decodeParams(c,b.data.replace("0x",""))[0],d(b)}})},ens.prototype.getOwner=function(a,b){this.getOwnerResolverAddress(this.registryABI.owner,this.getRegistryAddress(),a,b)},ens.prototype.getResolver=function(a,b){this.getOwnerResolverAddress(this.registryABI.resolver,this.getRegistryAddress(),a,b)},ens.prototype.getAddress=function(a,b){var c=this;c.getResolver(a,function(d){d.error?b(d):c.getOwnerResolverAddress(c.resolverABI.addr,d.data,a,b)})},ens.prototype.getName=function(a,b){var c=this;a=ens.normalise(a),c.getResolver(a,function(d){d.error||"0x"==d.data?b(d):ajaxReq.getEthCall({to:d.data,data:c.getDataString(c.resolverABI.name,[namehash(a)])},function(a){if(a.error||"0x"==a.data)b(a);else{var d=c.resolverABI.name.outputs.map(function(a){return a.type});a.data=ethUtil.solidityCoder.decodeParams(d,a.data.replace("0x",""))[0],b(a)}})})},ens.prototype.resolveAddressByName=function(a,b){var c=this;a=ens.normalise(a),c.getOwner(a,function(d){if(d.error||"0x"==d.data)b(d);else{var e=d.data;c.getName(a,function(a){b(a.error||"0x"==a.data?{data:e,error:!1}:{data:a.data,error:!1})})}})},ens.prototype.getDataString=function(a,b){var c=ethUtil.solidityUtils.transformToFullName(a),d=ethFuncs.getFunctionSignature(c),e=ethUtil.solidityUtils.extractTypeName(c),f=e.split(",");return f=""==f[0]?[]:f,"0x"+d+ethUtil.solidityCoder.encodeParams(f,b)},module.exports=ens;